var Z=Object.defineProperty;var _=(n,e,t)=>e in n?Z(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(_(n,typeof e!="symbol"?e+"":e,t),t);import{a as z,b as j,c as Y,d as $,V as h,e as q,f as J,C as ee,T as te,S as ne,g as P,P as ae,W as se,h as oe,O as ie,B as re,M as le,H as de,i as ce,j as he,k as pe,A as we,D as ue,l as me,G as g,m as ge,n as fe}from"./GLTFLoader-ydwnotiM.js";class f extends z{constructor(t={}){const{radius:a=1,res:s=12,color:l=65280,debug:r=!1}=t,m=new j(a,s,s),k=new Y({color:l});super(m,k);o(this,"isSphereMesh",!0);o(this,"isPrimitive",!0);if(r){const M=new $(1);this.add(M)}this.name="spherey"}}class H extends Array{constructor(){super(...arguments);o(this,"selectedIndex",0)}add(t){this.push(t)}swapFront(){return this.swap("front"),this}swapBack(){return this.swap("back"),this}swap(t){if(this.length<1){console.log("length must be greater than 1");return}if(t==="front"){const a=this.shift();this.push(a)}if(t==="back"){const a=this.pop();this.unshift(a)}}}class ve{constructor(e){o(this,"entities",[]);o(this,"owner",null);this.owner=e}setOwner(e){this.owner=e}add(e){this.entities.push(e),e.setup(e.owner)}run(){for(var e=0;e<this.entities.length;e++)this.entities[e].update.call(this.owner)}}class xe{constructor(e=""){o(this,"name","");this.name=e}update(){}start(){}setup(){}}function ye(n,e,t){return(1-t)*n+t*e}function Se(n,e,t){return Math.max(e,Math.min(n,t))}function ze(n,e=4){return n*(1-n)*e}const O=new h,ke=new h,D=new h,Me=new h;new h;const I=new h;class Pe extends J{constructor(){super();o(this,"vertical",new H);o(this,"horizontal",new H);o(this,"state","ready");o(this,"targetAnimation",{tile:null,positionA:new h,positionB:new h,positionStart:new h,positionStop:new h,currentTime:-1,alpha:0,runTime:.3,isRunning:!1,clock:new ee});this.entities=new ve(this),this.entities.add(new Te)}addHorizontal(t){this.horizontal.add(t),this.add(t)}snap(t,a,s,l,r=!1){if(r===!1){let m=this.getSnapPosition(t,a,s,l);a.position.copy(m)}else this.snapWithAnimation(t,a,s,l)}snapWithAnimation(t,a,s,l){if(this.state==="running")return;t.updateMatrix(),a.updateMatrix();let r=this.targetAnimation;r.positionStart.copy(a.position),r.positionStop.copy(this.getSnapPosition(t,a,s,l)),r.tile=a,r.currentTime=0,r.alpha=0,r.isRunning=!0,r.clock.start(),this.state="running"}getSnapPosition(t,a,s,l){return t.updateMatrix(),a.updateMatrix(),t[s].getWorldPosition(O),a.getWorldPosition(Me),a[l].getWorldPosition(ke),D.copy(a[l].position),I.copy(a.parent.worldToLocal(O)).sub(D),I}snapBackToFront(t=!1){const a=this.horizontal[this.horizontal.length-1],s=this.horizontal[0];this.snap(a,s,"east","west",t),this.horizontal.swapFront(),console.log(this.horizontal[0].name,this.horizontal[1].name)}snapFrontToBack(t=!1){const a=this.horizontal[0],s=this.horizontal[this.horizontal.length-1];this.snap(a,s,"west","east",t),this.horizontal.swapBack(),console.log(this.horizontal[0].name,this.horizontal[1].name)}snapAllInOrder(){for(var t=1;t<this.horizontal.length;t++)this.snap(this.horizontal[t-1],this.horizontal[t],"east","west")}}const V=new q,A=new h;class T extends J{constructor({item:t,paddingLeft:a=0,paddingRight:s=0,showDebugger:l=!1}={}){super();o(this,"isTile",!0);o(this,"verticalPoints",[]);o(this,"horizontalPoints",[]);o(this,"west",null);o(this,"east",null);o(this,"north",null);o(this,"south",null);o(this,"up",null);o(this,"down",null);if(t.position.set(0,0,0),t.rotation.set(0,0,0),t.updateMatrix(),window.pw=this,t)for(var r=0;r<t.children.length;r++)this.add(t.children[r]);V.setFromObject(this),V.getSize(A),this.verticalPoints[0]=new f({color:255,radius:2}),this.verticalPoints[1]=new f({color:255,radius:2}),this.add(this.verticalPoints[0]),this.add(this.verticalPoints[1]),this.west=this.verticalPoints[0],this.east=this.verticalPoints[1],this.west.position.x=-A.x/2+a,this.east.position.x=A.x/2+s,this.west.visible=l,this.east.visible=l}}const Ae=new h;class Te extends xe{setup(){}constructor(e="walk"){super(e)}update(){let e=this.targetAnimation;if(this.state==="running"&&e.isRunning){let t=e.clock.getDelta();e.currentTime+=t,e.alpha=e.currentTime/e.runTime,e.alpha=Se(e.alpha,0,1),e.tile.position.copy(Ae.lerpVectors(e.positionStart,e.positionStop,e.alpha)),e.tile.position.y=ye(e.positionStart.y,e.positionStart.y+-34,ze(e.alpha))}e.alpha>=1&&(e.isRunning=!1,this.state="ready")}}var b;let be=0;var L=null,S=null;new q;var p=null;const C=new H;function B(n){n.receiveShadow=!0,n.castShadow=!0,n.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})}async function Le(){window.THREE=te;const n=new ne;n.background=new P().setHSL(.5,1,.7);const e=document.getElementById("threedee1"),t=e.getBoundingClientRect().height,a=new ae(75,window.innerWidth/t,.1,2e3);a.position.fromArray([0,21.22465751184184,40.4622033919508]),a.lookAt(new h(0,0,0).fromArray([.00859148296684644,-.24372632714083164,-.9698059929072776]).multiplyScalar(1)),window.cam=a;const s=new se({antialias:!0});s.setSize(window.innerWidth,e.getBoundingClientRect().height),e.appendChild(s.domElement),s.shadowMap.enabled=!0,s.shadowMap.type=oe,b=new ie(a,s.domElement);const l=new re(1,1,1),r=new le({color:65280});new z(l,r);const m=new de(4329984,6086399,12);new ce(m,100);const k=document.getElementById("vertexShader").textContent,M=document.getElementById("fragmentShader").textContent,K={topColor:{value:new P(11392511)},bottomColor:{value:new P(15465727)},offset:{value:-1.1},exponent:{value:.4}},N=new j(1e3,32,15),Q=new he({uniforms:K,vertexShader:k,fragmentShader:M,side:pe}),U=new z(N,Q);n.add(U);const E=new we;E.intensity=1.81,n.add(E);const i=new ue;i.castShadow=!0,i.position.copy({x:-4.2,y:6,z:12.2}),i.intensity=2.7,i.color.setHex(16777215),n.add(i),i.shadow.mapSize.width=512*1,i.shadow.mapSize.height=512*1,i.shadow.camera.near=.5,i.shadow.camera.far=200,i.shadow.bias=1e-5,i.shadow.bias=1e-6,i.shadow.radius=.001,i.position.multiplyScalar(5);var v=48;i.shadow.camera.top=v,i.shadow.camera.bottom=-v,i.shadow.camera.left=v,i.shadow.camera.right=-v,new me(i.shadow.camera),window.addEventListener("resize",X);function X(){a.aspect=window.innerWidth/t,a.updateProjectionMatrix(),s.setSize(window.innerWidth,t)}{var d=await new g().loadAsync("../models/tacocar/tacocar1.glb");let c=d.scene;L=c,n.add(d.scene),B(c)}{var d=await new g().loadAsync("../models/tacocar/streetplate3.glb");S=d.scene,p=new Pe,n.add(p),p.position.z=20,window.streetTiles1=p,C.add(p);let w=new T({item:S.clone(),paddingLeft:2.4,paddingRight:-1.2,showDebugger:!0});p.addHorizontal(w),w.name="111",w.position.x+=-40;let W=new f({color:16776960,radius:6});w.add(W),W.position.y=22;let x=new T({item:S.clone(),paddingLeft:2.4,paddingRight:-1.2,showDebugger:!0});p.addHorizontal(x),x.name="222",x.position.x+=40;let F=new f({color:61166,radius:6});x.add(F),F.position.y=22;let y=new T({item:S.clone(),paddingLeft:2.4,paddingRight:-1.2,showDebugger:!0});p.addHorizontal(y),y.name="222",y.position.x+=80;let G=new f({color:16772846,radius:6});y.add(G),G.position.y=22,p.snapAllInOrder()}{const c=new ge(1,1),u=new Y({color:65280,side:fe}),w=new z(c,u);w.scale.setScalar(144),w.rotation.x=Math.PI/2,w.position.z=-60,n.add(w),w.receiveShadow=!0}{var d=await new g().loadAsync("../models/tacocar/sidewalk.glb");let u=d.scene;n.add(d.scene),B(u)}{var d=await new g().loadAsync("../models/tacocar/tree1.glb");let u=d.scene;n.add(d.scene),B(u)}{var d=await new g().loadAsync("../models/tacocar/building1.glb");d.scene,n.add(d.scene)}document.addEventListener("wheel",c=>{be+=c.deltaY}),document.addEventListener("keydown",c=>{c.key==="z"&&(console.log("z"),p.snapFrontToBack(!0)),c.key==="x"&&(console.log("z"),p.snapBackToFront(!0))});function R(){requestAnimationFrame(R),b!==void 0&&b.update(),L&&(L.position.x+=.1);for(var c=0;c<C.length;c++)C[c].entities.run();s.render(n,a)}R()}Le();
